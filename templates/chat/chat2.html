{% extends base_template %}
{% load static %}
{% block main-content %}


<div class="form-container">
    <div class="custom-container">
        <div class="icon-container">
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                    <path
                        d="M18.0991 9.91073L16.4304 8.24404L10.5899 2.41065C10.4334 2.25442 10.2213 2.16666 10 2.16666C9.77878 2.16666 9.5666 2.25442 9.41013 2.41065L3.56962 8.24404L1.9009 9.91073C1.74892 10.0679 1.66482 10.2784 1.66672 10.4969C1.66862 10.7154 1.75637 10.9244 1.91107 11.0789C2.06576 11.2334 2.27503 11.3211 2.4938 11.323C2.71256 11.3249 2.92332 11.2409 3.08068 11.0891L3.32515 10.8449V17.1666C3.32515 17.6087 3.50096 18.0326 3.81391 18.3452C4.12685 18.6577 4.5513 18.8333 4.99387 18.8333H7.49695C7.71823 18.8333 7.93045 18.7455 8.08693 18.5892C8.2434 18.433 8.3313 18.221 8.3313 18V14.6666C8.3313 14.4456 8.41921 14.2336 8.57568 14.0774C8.73215 13.9211 8.94438 13.8333 9.16566 13.8333H10.8344C11.0557 13.8333 11.2679 13.9211 11.4244 14.0774C11.5808 14.2336 11.6687 14.4456 11.6687 14.6666V18C11.6687 18.221 11.7566 18.433 11.9131 18.5892C12.0696 18.7455 12.2818 18.8333 12.5031 18.8333H15.0062C15.4487 18.8333 15.8732 18.6577 16.1861 18.3452C16.4991 18.0326 16.6749 17.6087 16.6749 17.1666V10.8449L16.9194 11.0891C17.0767 11.2409 17.2875 11.3249 17.5062 11.323C17.725 11.3211 17.9343 11.2334 18.089 11.0789C18.2437 10.9244 18.3314 10.7154 18.3333 10.4969C18.3352 10.2784 18.2511 10.0679 18.0991 9.91073Z"
                        fill="#374151" />
                </svg>
            </div>
        </div>
        <div class="text-container">
            <a href="http://" style="text-decoration: none">
                <div class="text">Dashboard</div>
            </a>
        </div>
        <div class="icon-container">
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                    <path
                        d="M7.78916 16.3333C7.56988 16.3333 7.35554 16.2649 7.17323 16.1369C6.99092 16.0088 6.84882 15.8269 6.76491 15.614C6.68101 15.4011 6.65905 15.1668 6.70181 14.9408C6.74458 14.7148 6.85015 14.5072 7.00519 14.3443L10.6567 10.5071L7.00519 6.67003C6.89928 6.56254 6.8148 6.43396 6.75668 6.2918C6.69857 6.14964 6.66798 5.99674 6.6667 5.84202C6.66542 5.6873 6.69348 5.53386 6.74923 5.39066C6.80499 5.24745 6.88732 5.11735 6.99144 5.00795C7.09556 4.89854 7.21936 4.81202 7.35564 4.75343C7.49192 4.69484 7.63794 4.66536 7.78517 4.6667C7.93241 4.66804 8.07792 4.70019 8.2132 4.76126C8.34849 4.82233 8.47085 4.9111 8.57314 5.02239L13.0087 9.68333C13.2165 9.90184 13.3333 10.1982 13.3333 10.5071C13.3333 10.8161 13.2165 11.1125 13.0087 11.331L8.57314 15.9919C8.36523 16.2104 8.08323 16.3333 7.78916 16.3333Z"
                        fill="#9CA3AF" />
                </svg>
            </div>
        </div>
        <div class="text-container">
            <div class="text">Chat</div>
        </div>
        <div class="icon-container">
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                    <path
                        d="M7.78916 16.3333C7.56988 16.3333 7.35554 16.2649 7.17323 16.1369C6.99092 16.0088 6.84882 15.8269 6.76491 15.614C6.68101 15.4011 6.65905 15.1668 6.70181 14.9408C6.74458 14.7148 6.85015 14.5072 7.00519 14.3443L10.6567 10.5071L7.00519 6.67003C6.89928 6.56254 6.8148 6.43396 6.75668 6.2918C6.69857 6.14964 6.66798 5.99674 6.6667 5.84202C6.66542 5.6873 6.69348 5.53386 6.74923 5.39066C6.80499 5.24745 6.88732 5.11735 6.99144 5.00795C7.09556 4.89854 7.21936 4.81202 7.35564 4.75343C7.49192 4.69484 7.63794 4.66536 7.78517 4.6667C7.93241 4.66804 8.07792 4.70019 8.2132 4.76126C8.34849 4.82233 8.47085 4.9111 8.57314 5.02239L13.0087 9.68333C13.2165 9.90184 13.3333 10.1982 13.3333 10.5071C13.3333 10.8161 13.2165 11.1125 13.0087 11.331L8.57314 15.9919C8.36523 16.2104 8.08323 16.3333 7.78916 16.3333Z"
                        fill="#9CA3AF" />
                </svg>
            </div>
        </div>
        <div class="text-container">
            <div class="text">Chats</div>
        </div>
    </div>

    <!-- ////////////////  div content ////////////////////// -->
    <div class="appointment-container">
        <div class="custom-box">
            <div class="custom-text">Chats</div>
        </div>
        {% if user_type == "2" %}
        <div class="scheduleappointment">
            <!-- <div class="appointment-text">Appointments</div> -->
            <a href="{% url "chatgroup" %}">
            <div class="appointment-text" type="button" class="btn btn-primary" 
                >
                Create New <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                    fill="none">
                    <path
                        d="M12.6919 11.335C13.0599 10.9423 13.3186 10.4877 13.4679 9.97101C13.6172 9.45434 13.6919 8.92568 13.6919 8.38501C13.6919 7.84368 13.6172 7.31468 13.4679 6.79801C13.3186 6.28134 13.0599 5.82701 12.6919 5.43501C13.4486 5.50368 14.0736 5.82034 14.5669 6.38501C15.0602 6.94901 15.3069 7.61568 15.3069 8.38501C15.3069 9.15368 15.0602 9.82034 14.5669 10.385C14.0736 10.949 13.4486 11.2657 12.6919 11.335ZM17.4689 18.615C17.5369 18.4563 17.5912 18.2887 17.6319 18.112C17.6719 17.936 17.6919 17.7577 17.6919 17.577V16.923C17.6919 16.433 17.6036 15.9663 17.4269 15.523C17.2502 15.081 16.9706 14.7157 16.5879 14.427C17.2712 14.637 17.8956 14.938 18.4609 15.33C19.0256 15.7213 19.3079 16.2523 19.3079 16.923V17.577C19.3079 17.8703 19.2079 18.117 19.0079 18.317C18.8092 18.5157 18.5629 18.615 18.2689 18.615H17.4689ZM19.3079 10.5H17.8079C17.6659 10.5 17.5469 10.452 17.4509 10.356C17.3556 10.26 17.3079 10.141 17.3079 9.99901C17.3079 9.85701 17.3556 9.73834 17.4509 9.64301C17.5469 9.54768 17.6659 9.50001 17.8079 9.50001H19.3079V8.00001C19.3079 7.85801 19.3559 7.73934 19.4519 7.64401C19.5479 7.54801 19.6666 7.50001 19.8079 7.50001C19.9499 7.50001 20.0686 7.54801 20.1639 7.64401C20.2599 7.73934 20.3079 7.85801 20.3079 8.00001V9.50001H21.8079C21.9492 9.50001 22.0679 9.54801 22.1639 9.64401C22.2599 9.74001 22.3079 9.85901 22.3079 10.001C22.3079 10.143 22.2599 10.2617 22.1639 10.357C22.0679 10.4523 21.9492 10.5 21.8079 10.5H20.3079V12C20.3079 12.142 20.2599 12.2607 20.1639 12.356C20.0679 12.452 19.9489 12.5 19.8069 12.5C19.6649 12.5 19.5462 12.452 19.4509 12.356C19.3556 12.26 19.3079 12.1413 19.3079 12V10.5ZM8.6919 11.385C7.86723 11.385 7.16123 11.091 6.57389 10.503C5.98656 9.91501 5.69256 9.20901 5.69189 8.38501C5.69189 7.55968 5.98589 6.85301 6.57389 6.26501C7.16056 5.67834 7.86656 5.38501 8.6919 5.38501C9.51723 5.38501 10.2236 5.67834 10.8109 6.26501C11.3982 6.85301 11.6919 7.55968 11.6919 8.38501C11.6919 9.20968 11.3982 9.91568 10.8109 10.503C10.2236 11.0903 9.51723 11.3843 8.6919 11.385ZM1.69189 17.577V16.969C1.69189 16.5563 1.81189 16.1703 2.05189 15.811C2.29256 15.451 2.61623 15.1717 3.02289 14.973C3.96623 14.5203 4.91056 14.181 5.85589 13.955C6.80056 13.7283 7.74589 13.615 8.6919 13.615C9.63856 13.615 10.5842 13.7283 11.5289 13.955C12.4736 14.1817 13.4179 14.521 14.3619 14.973C14.7686 15.1717 15.0919 15.451 15.3319 15.811C15.5719 16.1703 15.6919 16.5563 15.6919 16.969V17.577C15.6919 17.8703 15.5922 18.117 15.3929 18.317C15.1936 18.5157 14.9469 18.615 14.6529 18.615H2.73189C2.43856 18.615 2.19189 18.5153 1.99189 18.316C1.79256 18.1167 1.69289 17.87 1.69289 17.576"
                        fill="white" />
                </svg>
            </div>
            </a>

            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">
                                Add New Document Category
                            </h5>
                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row formrow">
                                <div class="col-md-6">
                                    <label for="exampleFormControlInput1" class="custom-form-label">Document
                                        Category Name
                                    </label>
                                    <input type="email" class="form-control" id="exampleFormControlInput1"
                                        placeholder="Name of the category" />
                                </div>
                                <div class="col-md-6">
                                    <label for="exampleFormControlInput1" class="custom-form-label">Status</label>
                                    <input type="email" class="form-control" id="exampleFormControlInput1"
                                        placeholder="----------" />
                                </div>
                            </div>
                        </div>
                        <!-- </div> -->
                        <div class="modal-footer">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button class="btn btn-color" type="submit">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>



    <div class="chats-conatiner">
        <div class="container">
            <div class="row">
                <div class="col-md-3 peopleview">
                    <div class="chatserach">
                        <div class="form-group mx-sm-3 mb-2">
                            <input type="text" class="form-control" id="searchInput" placeholder="Search">
                        </div>
                    </div>
                    {% for chat_group in groups %}
                    <div class="people-chat">
                        
                        <a href="javascript:void(0)" data-group-id="{{ chat_group.id }}" class="chat-group-link">
                            <div class="peoplevalue">
                                <div class="peopleimg">
                                    <img src="{% static "style/Styling/Bootstrap/img/Avatar.png" %}" alt="">
                                </div>
                                {% comment %} <a href="javascript:void(0)" data-group-id="{{ chat_group.id }}"
                                    class="chat-group-link"> {% endcomment %}
                                    <div class="profilename">{{ chat_group.group_name }}</div>
                                    {% comment %} <div class="icons-container">
                                        <div class="check-icons">
                                            <div class="inner-icon">
                                                18
                                            </div>
                                        </div>

                                    </div> {% endcomment %}
                                    {% comment %}
                                </a> {% endcomment %}
                            </div>
                        </a>
                       
                    <hr>
                    </div>
                     {% endfor %}
                    
                    {% comment %} <div class="people-chat">
                        <div class="peoplevalue">
                            <div class="peopleimg">
                                <img src="../Styling/Bootstrap/img/Avatar (1).png" alt="">
                            </div>
                            <div class="profilename">Agents Group</div>
                            <div class="icons-container">
                                <div class="check-icons">
                                    <div class="inner-icon">
                                        18
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div> {% endcomment %}
                </div>
                <div class="col-md-9">
                 <div class="chat-messages" id="chat-messages">
                    <!-- Chat messages will be displayed here -->
                    </div>
                    
                </div>
            </div>
           
        </div>

    </div>
</div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('.chat-group-link').click(function () {
            var groupId = $(this).data('group-id');

            // Check if the clicked group is already active
            if (!$(this).hasClass('active')) {
                // Deactivate all groups
                $('.chat-group-link').removeClass('active');

                // Activate the clicked group
                $(this).addClass('active');

                // Load chat messages for the selected group using AJAX
                loadGroupChat(groupId);
            }
        });
    });

    function loadGroupChat(groupId) {
        // Fetch chat messages for the selected group using AJAX
        $.ajax({
            url: `/get_group_chat_messages/?group_id=${groupId}`,
            success: function (data) {
                $('#chat-messages').html(data);
            }
        });
    }
</script>



<script>
    $(document).ready(function () {
        $('#searchInput').on('input', function () {
            var searchQuery = $(this).val().toLowerCase();

            // Hide all groups
            $('.people-chat').hide();

            // Show only the groups that match the search query
            $('.people-chat').filter(function () {
                return $(this).text().toLowerCase().includes(searchQuery);
            }).show();
        });
    });
</script>


{% endblock main-content %}